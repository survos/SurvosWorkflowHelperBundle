{% extends '@SurvosWorkflow/layout.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script src="//d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/viz.js@1.8.0/viz.js" type="javascript/worker"></script>
    <script src="https://unpkg.com/d3-graphviz@1.4.0/build/d3-graphviz.min.js"></script>

    <script>
        $(function() {
            let d = $('#digraph').text()
            d3.select("#graph").graphviz()
                .fade(false)
                .renderDot(d);
            // Handler for .ready() called.
        });


    </script>

{% endblock %}

{% block content %}


    <div class="row row-fluid">
        <div class="col-md-6">
            <div id="graph" style="text-align: center; width: 100% " ></div>
        </div>

        <div class="col-md-3">
            <h3>{{ flowCode }} States</h3>
            <ul class="list list-unstyled">
                {% for place in definition.places if place != definition.initialPlace %}
                    <li><b>{{ place }}</b>: {{ "%s.places.%s.description"|format(flowCode, place)|trans }}

                        <a class="hidden-print" href="{{ path('survos_workflow', {flowCode: flowCode, class: class, states: place|json_encode}) }}">Set</a>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <div class="col-md-3">
            <h3>{{ flowCode }} Transitions</h3>
            <ul class="list list-unstyled">
                {% for t in definition.transitions %}
                    <li>
                        <i>{{ t.name }}</i>
                        <span class="pull-right">
                                {{ t.froms|join(',') }}
                                <i class="fa fa-arrow-circle-right"></i> {{ t.tos|join(',') }}
                            </span>
                        <br />
                        {{ workflow_metadata(entity, 'description', t, flowCode)|trans  }}
                    </li>
                {% endfor %}
            </ul>
        </div>

    </div>

    <pre style="display: none;">
    <div id="digraph" >{{ workflow_digraph(entity, flowCode)|raw }}</div>
    </pre>



{% endblock %}
